{% extends "site_base.html" %}

{% load i18n %}
{% load humanize %}
{% load ifsetting_tag %}
{% load bootstrap_tags %}
{% load package_tags %}
{% load pagination_utils %}
{% load search_utils %}

{% block head_title %}{% trans "Welcome" %}{% endblock %}

{% block body_id %}search-results{% endblock %}

{% block body_base %}
    <div class="container">

        {% include "_messages.html" %}

        <div class="row">
            <div class="span12">
                <div class="well">
                    <form method="GET" action="." class="form-search">
                        {{ form.non_field_errors }}

                        <div class="field-wrapper">
                            {{ form.q.errors }}
                            <label for="id-search" style="display: none;">Search:</label>
                            {{ form.q }}
                        </div>

                        <fieldset>
                            <title>Advanced Options</title>

                            <div class="field-wrapper">
                                {{ form.has_releases.errors }}
                                <label for="id-has_releases">Has Releases:</label>
                                {{ form.has_releases }}
                            </div>

                            <div class="field-wrapper">
                                {{ form.start_date.errors }}
                                <label for="id-start_date">Start Date:</label>
                                {{ form.start_date }}
                            </div>

                            <div class="field-wrapper">
                                {{ form.end_date.errors }}
                                <label for="id-end_date">End Date:</label>
                                {{ form.end_date }}
                            </div>
                        </fieldset>

                        <input type="submit" class="btn primary" value="Search">
                    </form>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="span3">
                <div class="well">
                    <h3>Refine Results</h3>

                    <ul class="nav list">
                        {% if facets.fields and facets.fields.python_versions %}
                            <li class="nav-header">By Python Version</li>
                            {% for ver in facets.fields.python_versions %}
                                <li><a href="?{{ query_params }}&amp;python_version={{ ver.0 }}">{{ ver.0|default:'No python version' }} ({{ ver.1 }})</a></li>
                            {% endfor %}
                        {% endif %}

                        {% if facets.fields and facets.fields.operating_systems %}
                            <li class="nav-header">By Operating System</li>
                            {% for os in facets.fields.operating_systems %}
                                <li><a href="?{{ query_params }}&amp;operating_system={{ os.0 }}">{{ os.0|default:'No operating system' }} ({{ os.1 }})</a></li>
                            {% endfor %}
                        {% endif %}

                        {% if facets.fields and facets.fields.licenses %}
                            <li class="nav-header">By License</li>
                            {% for lice in facets.fields.licenses %}
                                <li><a href="?{{ query_params }}&amp;license={{ lice.0 }}">{{ lice.0|default:'No license' }} ({{ lice.1 }})</a></li>
                            {% endfor %}
                        {% endif %}

                        {% if facets.fields and facets.fields.implementations %}
                            <li class="nav-header">By Implementation</li>
                            {% for impl in facets.fields.implementations %}
                                <li><a href="?{{ query_params }}&amp;implementation={{ impl.0 }}">{{ impl.0|default:'No implementation' }} ({{ impl.1 }})</a></li>
                            {% endfor %}
                        {% endif %}

                        {% comment %}
                        {% if facets.dates and facets.dates.created %}
                            <li class="nav-header">By Date</li>
                            {% for mod in facets.dates.created %}
                                <li><a href="?{{ query_params }}&amp;start_date={{ mod.0 }}">{{ mod.0 }} - {{ mod.1 }}</a></li>
                            {% endfor %}
                        {% endif %}
                        {% endcomment %}
                    </ul>
                </div>
            </div>

            <div class="span9">
                <div class="results-wrapper">
                    {% for result in results %}
                        <div class="results">
                            {% include "search/partials/package.html" with result=result %}
                        </div>
                    {% empty %}
                        <p>No results found.</p>
                    {% endfor %}
                </div>

                {% if is_paginated %}
                    <div class="pagination">
                        <ul>
                            <li class="prev{% if not page.has_previous %} disabled{% endif %}"><a href="{% if page.has_previous %}{{ request.get_full_path|repage:page.previous_page_number }}{% else %}#{% endif %}">&larr; Previous</a></li>

                            {% for page_num in paginator.page_range|paginate_numbers:page.number %}
                                <li{% if page_num == page.number %} class="active"{% endif %}><a href="{{ request.get_full_path|repage:page_num }}">{{ page_num }}</a></li>
                            {% endfor %}

                            <li class="next{% if not page.has_next %} disabled{% endif %}"><a href="{% if page.has_next %}{{ request.get_full_path|repage:page.next_page_number }}{% else %}#{% endif %}">Next &rarr;</a></li>
                        </ul>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
{% endblock %}
